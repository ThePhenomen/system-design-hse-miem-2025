## Вводная информация

> A local radio station wants to connect DJs more closely to their audience, so audience members can request songs, vote on songs playing right now, vote on the DJ's daily play list, and so on.

> Users: unsure; whatever the local "music" community is.

> Requirements: near-real-time synced with the music on the air; user voting mechanism; mobile-device accessibility.

## Отсев

**Вопросы к собеседнику:**
* Уточнить, планируется ли в дальнейшем расширять функционал приложения: добавления донатов для передачи сообщений в эфир/выбора музыки и т.д..
* Какой штат ИТ-сотрудников есть на текущий момент, есть ли какая-либо инф-ра на текущий момент и где она расположена (узнать, где будет хостяться сервисы + определить компетенцию сотрудников заказчика).
* Нужно ли обозначать SLA (насколько критичен простой - невозможность запускать голосования и т.д.).
* Действительно ли требуется real-time система (дорого и сложно в реализации).
* Есть ли уже какое-то мобильное приложение (писать с 0 или интегрировать в имеющуюся).
* Где данное радио транслируются - в мегаполисе либо маленьких городах.

## Scope Refinement

* Есть локальное комьюнити слушателей радио (количество точное неопределено).
* Требуется реализовать: синхронизацию практически в real-time приложения с эфиром, добавить возможность взаимодействия ведущих с аудиторией: голосования, запросы на музыку. Приложение должно быть реализовано для смартфонов.

## Функциональные требования

* Трансляция музыки практически 1 в 1 с прямым эфиром (уточнить про максимально возможную рассинхронизацию).
* Регистрация пользователей (уточнить у собеседника насчет вида регистрации: по номеру телефону или логину и паролю) - при необходимости (уточнить у собеседника).
* Авторизация (связано со 2 пунктом).
* Голосование за список следующей в очереди музыки (предложение своих треков или из заранее подготовленного списка).
* Создание запросов на включение определенной песни.
* Поддержка мобильных устройств.
* Публикация в Play Market/ App store.
* Интеграция с платежными системами (вытекает из 1 пункта этапа отсева).
* Наличие общего чата для пользователей с ведущими.
* Наличие уведомление (о новых программах, текущей программе).


## Нефункциональные требования

* Рассматривается микросервисная архитектура или монолит (обговорить с собеседником, возможно требуется реализовать систему как можно скорее, либо уже есть некоторы наработки и необходимо использовать их, возможно нет бюджета на поддержку распределенных систем).
* Мониторинг (в данной системе будет нужен, определять пиковые нагрузки, выход компонентов из строя - однако, если требуется mvp, то на начальных этап полный стек реализовывать нет смысла)
* Логирование (есть смысл реализовывать, отслеживать возникающие проблемы)
* Tracing (в данной системе нет смысла - большого количества сервисов в ближайшее время не будет, будет избыточно).
* Безопасность (mTls внутри системы, использование jwt токенов в случае необходимости авторизации пользователей, ограничение функционала для неавторизованных пользователей, фаервол, необходимость вынесения фронта в демилиторизованную сеть, а бек - во внутреннюю сеть).
* Надежность (необходиомсть горячего/холодного резерва - в случае утверждения высокого SLA, масштабирование (сложный вопрос, который зависит от варианта инсталляции системы, текущих мощностей, сложившегося подхода, отличия пиковой нагрузки от средней)).
* Удобство администрирования (использование службы каталога для хранения пользователей, удобство подключения к хостам (настройка VPN)).
* Интеграция с внутренними сервисами (уточнить, есть ли такая потребность).
* Производительность (сколько запросов будет выдерживать в среднем и в пике, следует из следующего пункта)
* Объем документации.

## Ограничения

* Привязка к отечественному вендору (Астра, РедОС, Альт).
* Привязка к СУБД (в зависимости от того, какие уже используются).
* Привязка к ЯП.
* Как скоро должно быть готово решение (MVP или нет).
* Привязка к провайдеру инфраструктуры (On-prem, Cloud).

## Расчет нагрузки

**Трафик:**
* Предположим, что для Москвы. Тогда:
    * В Москве проживает 11 млн человек.
    * Большинство времени радио слушают в машине.
    * В среднем на одну семью (3 человека) приходится 1 машина.
    * Предположим, что наше радио лушают 10% людей.
    * Самый большой трафик в Москве утром и вечером. Предположим, что 40% людей в это время находятся за рулем.
    * Тогда получим, сколько человек одновременно могут слушать радио -> 150 000 человек.
    * Определим, сколько человек может пользоваться приложением одновременно:
        *  В среднем (не все могут отвлекаться за рулем и не всем это интересно - предположим, 10% - с учетом того, что не у всех есть приложение) -> 15 000 человек. То есть при добавлении нового голования в систему могут поступать порядка 10 000 - 15 000 запросов в течении нескольких минут.
        *  Пиковая нарузка может составлять до 40% от общего количества слушателей (при розыгрышах или проигрывание нового трека) -> до 60 000 запросов в течении нескольких минут.

**БД:**
* При высокой нагрузке следует  использовать базу данных для кэша (иначе количество запросов в систему и в базу данных будет примерно совпадать - высокая нагрузка). Также при использовании реалиционной базы данных следует минимизировать количество операций записи на диск для уменьшения задержек при работе с данными.
